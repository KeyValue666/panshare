# 爬虫模块

## 爬虫模块逻辑图

![image-20230325221950966](C:\Users\27643\AppData\Roaming\Typora\typora-user-images\image-20230325221950966.png)

>   流程如下
>
>   初始化redis中的种子库————>定时任务定时从redis中获取种子————>种子提取器采集种子————>页面解析器解析种子详细页面————>封装结果入库

## 初始化Redis种子库

>   因为爬虫的目标网站比较明确，因此该爬虫模块只针对性分析了目标网站。项目中对目标网站的相关URL均已手动打码:joy:。因为目标网站中都存在分页、分类情况，因此我用目标网站域名+资源分类为键，页码为值，数据结构采用set放入Redis中，并对每个键进行初始化，每个键初始化为500，意味着每个网站的每种资源分类都可以爬取500页，每页20条种子，数据量也是很ok的。此后开启定时任务定时从随机网站、随机分类、从set中随机弹出页码加入到爬取队列。当redis中的页码全部弹出完时说明采集任务完成。

## 种子采集器

>   种子采集器的任务是将redis中获取的页码封装成种子页面的URL，通过HTTP请求获取种子集合。每次获取的种子集合都会封装成一个Task，该Task实现了Runnable接口，因此在种子采集器中维护了一个线程池，用来多线程异步的执行Task(Task就是主要是用来解析种子详情页面，是个十分耗时的操作)。因为目标网站不止一个，因此种子采集器中存在多个错开时间的Schedule，这样采集效率不仅高而且对目标网站危害不大。

## 过滤器

>该过滤器是建立在redis中的。该过滤器以网站名称为键，种子详情链接为值，数据结构采用set实现过滤。因此在每次页面解析器将要解析详情页面时都会走一遍过滤器从而验证是否是重复页面。

## 页面解析器

>   种子详情页面当然就是采集结果了，这部分主要使用Jsoup对页面进行降噪(使用CSS选择器选择页面数据)采集自己需要的数据封装成实体存入数据库中。

## 请求错误处理

>   爬虫避免不了会出现网络请求错误，以下是本项目出现的错误和解决方法
>
>   1.  redis中弹出的页码超出范围或者请求出错
>
>       >对redis中弹出的页码会首先做尝试请求，对超出范围的页码会进行丢弃，对于出错的页面则放回redis中继续等待下次弹出。
>
>   2.  详情页面解析出错
>
>       >详情页面解析是在Task中执行的，页面解析成功则放入redis过滤中，反之则丢弃。

